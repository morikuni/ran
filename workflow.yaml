env:
  GO111MODULE: on

vars:
  test: &test go test -v ./...

commands:
  test:
    description: Run test
    workflow:
    - name: test
      cmd: *test

  build:
    description: Run test, then build
    workflow:
    - name: test
      cmd: *test

    - name: build
      cmd: go build -o bin/workflow cmd/workflow/main.go
      when:
      - test.succeeded
